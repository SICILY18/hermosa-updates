version: 1
backend:
  phases:
    build:
      commands:
        - echo "Backend build phase - using Supabase for database"
frontend:
  phases:
    preBuild:
      commands:
        # Install Composer
        - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
        # Install PHP dependencies
        - composer install --no-dev --optimize-autoloader --no-interaction
        # Install Node.js dependencies  
        - npm ci --only=production
        # Copy environment file
        - cp env-aws-production-template.txt .env
    build:
      commands:
        # Build frontend assets
        - npm run build
        # Laravel optimization commands
        - php artisan config:cache
        - php artisan route:cache
        - php artisan view:cache
        # Set proper permissions
        - chmod -R 755 storage bootstrap/cache
    postBuild:
      commands:
        - echo "Build completed successfully"
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
    name: hermosa-water-district
  cache:
    paths:
      - node_modules/**/*
      - vendor/**/*
      - bootstrap/cache/**/* 